<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>餐廳-FoodieTime 食刻</title>
<meta name="description"
	content="探索各種泰式料理，尋找您喜愛的泰國風味美食。FoodieTime 食刻提供多樣化的泰式餐廳選擇，滿足您的味蕾需求。">
<link rel="stylesheet" th:href="@{/css/front/favoritelist/style.css}">
<link rel="stylesheet"
	th:href="@{/css/front/restaurant/restaurant-categories.css}">
<link rel="stylesheet"
	th:href="@{/css/front/restaurant/food-categories.css}">
<link rel="stylesheet"
	th:href="@{/css/front/restaurant/thai-cuisine.css}">
<link rel="stylesheet"
	href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined">
<link
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
	rel="stylesheet">

<meta name="theme-color" content="#FF5722">
<link rel="apple-touch-icon" th:href="@{/images/icons/logo.png}">

</head>

<body>
	<header class="app-header">
		<div class="header-container">
			<div class="logo-container">
				<a th:href="@{/category/index}" class="logo"> <img
					th:src="@{/images/icons/logo.png}" alt="FoodieTime 食刻"
					class="logo-img"> <span class="logo-text">FoodieTime
						食刻</span>
				</a>
			</div>
			<div class="search-container">
				<div class="search-bar">
					<i class="material-icons-outlined search-icon">search</i> <input
						type="text" placeholder="搜尋餐廳、料理或地址..." class="search-input">
				</div>
			</div>
			<nav class="main-nav">
				<ul class="nav-list">
					<!--  <li class="nav-item"><a href="map.html" class="nav-link">地圖</a></li> -->
					<li class="nav-item"><a href="group-order.html"
						class="nav-link">團購</a></li>
					<li class="nav-item"><a href="deals.html" class="nav-link">優惠</a></li>
					<li class="nav-item"><a th:href="@{/category/login}"
						class="nav-link login-btn">登入/註冊</a></li>
				</ul>
				<button class="menu-toggle" aria-label="開啟選單">
					<i class="material-icons-outlined">menu</i>
				</button>
			</nav>
		</div>
	</header>

	<main>
		<section class="page-header">
			<div class="container">
				<h1 class="page-title" th:text="${categoryName}">分類名稱</h1>
				<p class="page-description"
					th:text="'探索道地的 ' + ${categoryName} + '，從傳統小吃到精緻料理'">分類描述</p>
			</div>
		</section>

		<div class="container">
			<div class="restaurant-list">
				<article class="restaurant-detail" th:each="store : ${storeList}">
					<div class="restaurant-header">
						<div class="restaurant-main-info">
							<img th:src="@{/images/restaurant/placeholder.svg}" alt=""
								class="restaurant-image">
							<div class="restaurant-primary-info">
								<h2 class="restaurant-name" th:text="${store.storName}">店家名稱</h2>
								<p class="restaurant-category"
									th:text="${store.storeCate.storCatName}">分類標籤</p>
								<div class="restaurant-actions">
									
								</div>
							</div>
						</div>
						<div class="restaurant-contact-info">
							<div class="info-item">
								<i class="fas fa-map-marker-alt"></i><span
									th:text="${store.storAddr}">地址</span>
							</div>
							<div class="info-item">
								<i class="fas fa-phone"></i><span th:text="${store.storPhone}">電話</span>
							</div>
							<div class="info-item">
								<i class="fas fa-clock"></i> <span
									th:if="${store.storOffDay != null}"
									th:text="'營業時間: ' + ${store.storOnTime} + ' - ' + ${store.storOffTime} + '（' + ${weekMap[store.storOffDay]} + '公休）'">
								</span> <span th:unless="${store.storOffDay != null}"
									th:text="'營業時間: ' + ${store.storOnTime} + ' - ' + ${store.storOffTime} + '（公休日不固定）'">
								</span>
							</div>
							<div class="info-item"
								th:if="${store.storWeb != null and !store.storWeb.isEmpty()}">
								<i class="fas fa-globe"></i> <a
									th:href="${store.storWeb.startsWith('http') ? store.storWeb : 'http://' + store.storWeb}"
									th:text="${store.storWeb}" class="website-link">網站連結</a>
							</div>
						</div>
					</div>
					<div class="restaurant-details-tabs">
						<div class="tabs-header">
							<button class="tab-btn active" data-tab="menu">菜單</button>
							<button class="tab-btn" data-tab="info">店家資訊</button>
						</div>
						<div class="tabs-content">
							<div class="tab-content active" id="menu-content">
								<div class="menu-items">
									<div class="menu-item" th:each="prod : ${productList}"
										th:if="${prod.store.storId} == ${store.storId}">
										<img th:src="@{/images/restaurant/placeholder.svg}" alt=""
											class="menu-item-image">
										<div class="menu-item-info">
											<h3 class="menu-item-name" th:text="${prod.prodName}">商品名稱</h3>
											<p class="menu-item-description" th:text="${prod.prodDesc}">商品描述</p>
											<span class="menu-item-price"
												th:text="'NT$ ' + ${prod.prodPrice}">價格</span>
										</div>
									<!--  	<button class="add-to-cart-btn">
											<i class="fas fa-plus"></i>
										</button> -->
										<button class="favorite-btn" th:data-prodid="${prod.prodId}">
										<i class="far fa-heart"></i> 收藏
									</button>
									</div>
								</div>
							</div>
							<div class="tab-content" id="info-content">
								<div class="info-section">
									<h3 class="info-title">店家位置</h3>
									<div class="map-container">
										<img th:src="@{/images/restaurant/map-placeholder.svg}"
											alt="地圖" class="location-map">
									</div>
								</div>
							</div>
						</div>
					</div>
				</article>
			</div>
		</div>
	</main>

	<footer class="app-footer">
		<div class="container">
			<p>&copy; 2024 FoodieTime 食刻. All rights reserved.</p>
		</div>
	</footer>

	<script>
	// 收藏按鈕功能
  document.querySelectorAll('.favorite-btn').forEach(btn => {
    btn.addEventListener('click', function () {
        const prodId = this.dataset.prodid;

        fetch('/favorite/add', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ prodId })
        })
        .then(res => {
            if (!res.ok) return res.json().then(err => { throw new Error(err.error); });
            return res.json();
        })
        .then(data => alert("已加入收藏"))
        .catch(err => {
            if (err.message === "請先登入會員") {
                showLoginPrompt(); // ➜ 這是你等下要新增的函式
            } else {
                alert("錯誤：" + err.message);
            }
        });
});
	
    document.addEventListener('DOMContentLoaded', function () {
        // 找所有餐廳卡片
        document.querySelectorAll('.restaurant-detail').forEach(function (restaurantCard) {
            const tabBtns = restaurantCard.querySelectorAll('.tab-btn');
            const tabContents = restaurantCard.querySelectorAll('.tab-content');

            tabBtns.forEach(function (btn) {
                btn.addEventListener('click', function () {
                    // 移除其他按鈕的 active
                    tabBtns.forEach(b => b.classList.remove('active'));
                    // 隱藏所有內容
                    tabContents.forEach(c => c.classList.remove('active'));

                    // 加上點擊的 active
                    btn.classList.add('active');
                    const tabId = btn.getAttribute('data-tab') + '-content';
                    const contentToShow = restaurantCard.querySelector('#' + tabId);
                    if (contentToShow) {
                        contentToShow.classList.add('active');
                    }
                });
            });
        });
    });
    function showLoginPrompt() {
        document.getElementById('login-prompt-modal').style.display = 'flex';
    }
    function closeLoginPrompt() {
        document.getElementById('login-prompt-modal').style.display = 'none';
    }
	</script>
	<div id="login-prompt-modal" style="display: none; position: fixed; z-index: 9999; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.5); align-items: center; justify-content: center;">
  <div style="background: #fff; padding: 2em; border-radius: 10px; text-align: center; max-width: 300px; box-shadow: 0 2px 10px rgba(0,0,0,0.3);">
    <h3>⚠️ 請先登入會員</h3>
    <p style="margin: 1em 0;">您必須登入會員才能加入收藏清單。</p>
    <div style="margin-top: 1em;">
      <button onclick="location.href='/category/login'" style="margin-right: 10px;">立即登入</button>
      <button onclick="closeLoginPrompt()">取消</button>
    </div>
  </div>
</div>
</body>
</html>