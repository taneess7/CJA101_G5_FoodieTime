<!DOCTYPE html>
<html lang="zh-TW" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>商家後台管理 - FoodieTime 食刻</title>
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    

    <meta name="theme-color" content="#FF5722">


    <link rel="stylesheet" th:href="@{/css/front/store/store_edit2.css}">
    <link rel="stylesheet" th:href="@{/css/front/store/sc.css}">
    <link rel="stylesheet" th:href="@{/css/common/index.css}">

</head>
<body>
<body>
<header  style=" padding: 5px;">
    <div class="container" style="display: flex; justify-content: space-between; align-items: center;">
        <a th:href="@{/}" class="logo" style="font-weight: 800;  font-size: 24px; color: #9DB17C;text-decoration: none;">
            FoodieTime<span style="color: var(--accent-color-1);">食刻</span>
        </a>
        <nav class="main-nav">
            <a th:href="@{/index}" class="clay clay-button clay-convex">回首頁</a>
            <a th:href="@{/front/member/member_center}" class="clay clay-button clay-convex">會員</a> 
             <a th:href="@{/front/member/logout}" class="clay clay-button clay-convex">登出</a>       
        </nav>
    </div>
</header>
	
  <main class="dashboard" >
    <aside class="sidebar">
      <h2>商家管理</h2>
      <button class="tab-btn active" data-tab="store">編輯店家</button>
      <button class="tab-btn" data-tab="coupon">編輯優惠券</button>
      <button class="tab-btn" data-tab="activity-view">查看活動</button>
      <button class="tab-btn" data-tab="product">上傳商品</button>
      <button class="tab-btn" data-tab="product-view">查看商品</button>   
      <button class="tab-btn" data-tab="act-product-view">活動商品</button>           
      <button class="tab-btn" data-tab="group-promotion-add">新增團購促銷</button>
      <button class="tab-btn" data-tab="group-promotion-list">查看團購促銷</button>

   
      <a href="@{/front/member/logout}" 
       class="member-nav-item flex items-center space-x-2 text-red-600 hover:text-red-800 mt-6">
        <i class="material-icons-outlined">logout</i>
        <span>登出</span>
     </a>

             
    </aside>
	
	
<!-- 店家資料維護頁 -->
    <section class="content-panel active" id="tab-store">
      <iframe th:src="@{/store/store_edit2}" height="1400"></iframe>
    </section>

<!-- <section class="content-panel active" id="tab-store"> -->
<!--   <!-- 假設條件是 storeVO 不為 null -->
<!--   <div th:if="${storeVO != null}"> -->
<!--     <div th:insert="~{/front/store/store_edit2 :: storeEdit2Fragment}"></div> -->
<!--   </div> -->
<!-- </section> -->



<!-- 店家優惠券維護頁 -->
    <section class="content-panel" id="tab-coupon">
      <iframe th:src="@{/store/editCoupon}" height="1000"></iframe>
    </section>
    
    
<!-- 上傳商品 -->
    <section class="content-panel" id="tab-product">
      <h1 class="section-title">上傳商品</h1>
      <div class="form-group">
        <label for="productType">商品類型</label>
        <select class="form-input" id="productType">
          <option value="normal">一般商品</option>
          <option value="group">團購商品</option>
        </select>
      </div>
      <form id="productForm">
        <div class="form-group" id="normalProductUpload">
          <label>商品圖片</label>
          <div class="image-upload-section" id="productImageUpload">
            <i class="material-icons-outlined upload-icon">cloud_upload</i>
            <div class="upload-text">點擊或拖拽上傳商品圖片</div>
            <input type="file" id="product-image" accept="image/*" style="display: none;" />
            <img id="productImagePreview" class="image-preview" alt="預覽圖片">
          </div>
        </div>
        <button type="submit" class="btn" id="saveNormalProduct">儲存商品</button>
      </form>
      <button type="button" class="btn" id="addGroupProductBtn" style="display:none;margin-top:20px;">新增團購商品</button>
      <iframe id="groupProdAddFrame" src="/store/group-prod-add" style="width:100%;height:900px;display:none;border:none;"></iframe>
    </section>


<!-- 查看商品 -->
    <section class="content-panel" id="tab-product-view">
      <h2>已上傳商品</h2>
      <div class="form-group">
        <label for="productViewType">商品類型</label>
        <select class="form-input" id="productViewType">
          <option value="normal">一般商品</option>
          <option value="group">團購商品</option>
        </select>
      </div>
      <div id="normalProductList" class="product-list">
        <!-- 一般商品將由 JS 動態插入 -->
      </div>
      <iframe id="groupProductListFrame" src="/store/group-prod-list" style="width:100%;height:900px;display:none;border:none;"></iframe>
    </section>

<!-- 查看參加活動的商品 -->
    <section class="content-panel" id="tab-act-product-view">
       <iframe th:src="@{/act/actProducts}" height="1000"></iframe>
    </section>
    

<!-- 查看活動 -->    
	<section class="content-panel" id="tab-activity-view">
      <iframe th:src="@{/act}" height="1000"></iframe>
    </section>

<!-- 新增團購促銷頁 -->
    <section class="content-panel" id="tab-group-promotion-add">
      <iframe th:src="@{/store/group-promotion-add}" style="width:100%;height:900px;border:none;"></iframe>
    </section>

<!-- 查看團購促銷 -->
<section class="content-panel" id="tab-group-promotion-list">
  <iframe th:src="@{/store/group-promotion-list}" style="width:100%;height:900px;border:none;"></iframe>
</section>



    
  </main>
  

  <script>
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        const tab = btn.dataset.tab;
        document.querySelectorAll('.content-panel').forEach(p => p.classList.remove('active'));
        document.getElementById('tab-' + tab).classList.add('active');
      });
    });
  
    const productImageInput = document.getElementById('product-image');
    const productImageUpload = document.getElementById('productImageUpload');
    const productForm = document.getElementById('productForm');
    const productList = document.getElementById('productList');
    const previewContainer = document.createElement('div');
    previewContainer.className = 'preview-container';
    productImageUpload.appendChild(previewContainer);
  
    let products = [];
  
    productImageInput.setAttribute('multiple', true);
  
    productImageUpload.addEventListener('click', () => productImageInput.click());
  
    productImageInput.addEventListener('change', e => {
      previewContainer.innerHTML = '';
      [...e.target.files].forEach(file => {
        if (file.size <= 3 * 1024 * 1024) {
          const reader = new FileReader();
          reader.onload = e => {
            const img = document.createElement('img');
            img.src = e.target.result;
            img.className = 'image-preview';
            img.style.display = 'block';
            previewContainer.appendChild(img);
  
            products.push({ name: '', imgSrc: e.target.result });
          };
          reader.readAsDataURL(file);
        } else {
          alert('圖片請小於 3MB');
        }
      });
    });
  
    productForm.addEventListener('submit', function(e) {
      e.preventDefault();
      renderProductList();
      previewContainer.innerHTML = '';
      this.reset();
      alert("上傳完成！請至『查看商品』分頁進行編輯。");
    });
  
    function renderProductList() {
      productList.innerHTML = products.map((p, index) => `
        <div class="product-card">
          <button class="delete-btn" onclick="deleteProduct(${index})">×</button>
          <img src="${p.imgSrc}" alt="商品圖片" />
          <div class="info">
            <input type="text" value="${p.name}" placeholder="輸入商品名稱" id="name-${index}" />
            <button class="save-btn" onclick="saveProduct(${index})">儲存</button>
          </div>
        </div>
      `).join('');
    }
  
    function deleteProduct(index) {
      products.splice(index, 1);
      renderProductList();
    }
  
    function saveProduct(index) {
      const nameInput = document.getElementById(`name-${index}`);
      products[index].name = nameInput.value;
      alert('商品已儲存！');
    }

    document.getElementById('productType').addEventListener('change', function() {
      if (this.value === 'group') {
        document.getElementById('normalProductUpload').style.display = 'none';
        document.getElementById('saveNormalProduct').style.display = 'none';
        document.getElementById('addGroupProductBtn').style.display = 'none';
        document.getElementById('groupProdAddFrame').style.display = 'block';
      } else {
        document.getElementById('normalProductUpload').style.display = '';
        document.getElementById('saveNormalProduct').style.display = '';
        document.getElementById('addGroupProductBtn').style.display = 'none';
        document.getElementById('groupProdAddFrame').style.display = 'none';
      }
    });

    // 商品查詢分頁切換
    document.getElementById('productViewType').addEventListener('change', function() {
      if (this.value === 'group') {
        document.getElementById('normalProductList').style.display = 'none';
        document.getElementById('groupProductListFrame').style.display = 'block';
      } else {
        document.getElementById('normalProductList').style.display = '';
        document.getElementById('groupProductListFrame').style.display = 'none';
      }
    });
    // 預設顯示一般商品
    document.getElementById('normalProductList').style.display = '';
    document.getElementById('groupProductListFrame').style.display = 'none';
  </script>
  
  
</body>
</html>
