<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>æŸ¥çœ‹åƒèˆ‡åº—å®¶</title>
<!-- å¼•å…¥iconåœ–ç‰‡ -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
 <!-- header/footer cs -->
  <link rel="stylesheet" th:href="@{/css/common/index.css}">
  <link rel="stylesheet" th:href="@{/css/common/style.css}">
  
 <style>
    /* act.css */

.act-card {
  width: 400px;
  border: 1px solid #ddd;
  border-radius: 10px;
  overflow: hidden;
  background-color: #fff;
  box-shadow: 0 0 5px rgba(0,0,0,0.1);
}

.act-card img {
  width: 100%;
  height: 180px;
  object-fit: cover;
}

.act-body {
  padding: 1rem;
}

.act-title {
  font-size: 1.2rem;
  font-weight: bold;
  margin-bottom: 0.5rem;
}

.act-meta {
  font-size: 0.9rem;
  color: #666;
  margin-bottom: 0.25rem;
}

.act-desc {
  font-size: 0.95rem;
  margin-top: 0.75rem;
}

.acts-list {
  display: flex;         /* å•Ÿç”¨æ©«å‘æ’åˆ— */
  flex-wrap: wrap;       /* è¶…å‡ºè‡ªå‹•æ›è¡Œ */
  justify-content: center; /* å¡ç‰‡é å·¦å°é½Š */
 /* flex-direction: column;/*ç›´æ’*/
  gap: 1.5rem;
  /*max-width: 800px; æœƒé™åˆ¶æ©«å‘æ’åˆ—æœ€å¤§å¯¬åº¦ æ­é…margin: 0 auto å¡ç‰‡ç›´æ’ç½®ä¸­*/
  margin: 0 ;
  padding: 1rem;
  padding-top: 100px;
}

.act-item {
  display: flex;
  border-radius: 20px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  overflow: hidden;
  align-items: center;
  gap: 1rem;
  width: 450px;          /* âœ… å›ºå®šå¯¬åº¦ */
  flex-shrink: 0;        /* âœ… é¿å…ç¸®å°è®Šå½¢ */
}

/* æ»‘é¼ ç§»ä¸Šå»æ™‚çš„æ•ˆæœ */
.act-item:hover {
  transform: translateY(-5px); /* ä¸Šæµ® 5px */
  box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2); /* åŠ å¼·é™°å½± */
  
}

.act-item img {
  width: 100px;
  height: 100px;
  object-fit: cover;
  border-radius: 10px;
}

.act-details {
  flex: 1;
}

.act-name {
  font-weight: bold;
  font-size: 1.2rem;
  margin-bottom: 0.5rem;
  color:rgb(76, 175, 80);
}

.act-content {
  font-size: 0.95rem;
  line-height: 1.5;
}

.act-dates {
  font-size: 0.85rem;
  margin-top: 0.5rem;
  color: #666;
}

.act-discount {
  font-weight: bold;
  font-size: 1.1rem;
  white-space: nowrap;
}

.btn-secondary {
  position: relative;
  background-color: #f99ca1; /* ç²‰ç´…è‰²èƒŒæ™¯ */
  border: none;
  padding: 8px 12px;
  font-size: 15px;
  color: black;
  font-weight: bold;
  cursor: pointer;
  overflow: hidden;
   border-radius: 8px; /* â† åœ“è§’è¨­å®š */
}
.btn-secondary:hover {
  background-color: rgb(255, 128, 192);
}

.acts-container {
  background-color: rgb(255, 128, 128);
  display: flex;
  flex-wrap: wrap;      /* âœ… å¤šçš„è‡ªå‹•æ›è¡Œ */
  flex-direction: row;  /* âœ… æ°´å¹³æ’åˆ—ï¼ˆé è¨­å°±æ˜¯ rowï¼Œå¯ä»¥åŠ å¼·æ˜ç¢ºæ€§ï¼‰ */
  justify-content: flex-start; /* âœ… å·¦å°é½Š */
  gap: 1.5rem;          /* âœ… å¡ç‰‡é–“è· */
}

 .app-header {
    position: fixed;           /* âœ… å›ºå®šåœ¨ç•«é¢é ‚éƒ¨ */
    top: 0;
    left: 0;
    width: 100%;               /* æ’æ»¿æ•´å€‹å¯¬åº¦ */
    z-index: 50;               /* ç¢ºä¿è“‹åœ¨ä¸Šæ–¹ */
    height: 64px;
    background-color: white;
    padding: 0 1rem;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    display: flex;
    align-items: center;
  }
  
  body {
  background-color: #fdf4f1;
  }
 table {
  width: 100%;
  }

#store-modal {
  max-width: 350px;           /* é™åˆ¶å¯¬åº¦ */
  max-height: 500px;          /* é™åˆ¶é«˜åº¦ */
  overflow-y: auto;           /* å‚ç›´æ–¹å‘å‡ºç¾æ»¾å‹•æ¢ */
  padding: 16px;
  background-color: #fff;
  border-radius: 12px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.15);
}

.card {
  display: flex;
  background-color: white;   /* å³å´ç™½åº• */
  border-radius: 12px;
  overflow: hidden;            /* é—œéµï¼šè®“åœ“è§’èˆ‡å…§éƒ¨åˆ†å€ç”Ÿæ•ˆ */
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  
}

.card-left {
  background-color: #A86F60;      /* å·¦åŠç™½åº• */
  padding: 10px;
  flex: 0 0 40%;               /* å›ºå®šå·¦é‚Š 40% */
  display: flex;
  justify-content: center;
  align-items: center;
}

.card-left img {
  width: 100%;
  height: auto;
}

.card-right {
 width: 320px;
  padding: 10px;
  flex: 1;                     /* å³å´è‡ªå‹•å¡«æ»¿ */
}


#modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background-color: rgba(0, 0, 0, 0.5); /* åŠé€æ˜é»‘è‰² */
  z-index: 999; /* è“‹åœ¨å…§å®¹ä¸Šï¼Œä½†ä½æ–¼ modal */
}
#store-modal {
  z-index: 1000; /* ç¢ºä¿å½ˆçª—åœ¨é®ç½©ä¸Š */
}

  </style>


</head>
<body>
 <header th:replace="~{front/common/header :: main-header}"></header> 
 <div id="modal-overlay" style="display:none;"></div>

<div id="acts-container" class="acts-list">
 
<!-- æ´»å‹•å¡ç‰‡æ’å…¥é€™è£¡ -->
<!-- Modalï¼šæŸ¥çœ‹åƒèˆ‡åº—å®¶ï¼Œæœƒè·³å‡ºåº—å®¶æç¤ºçª— -->
	<div id="store-modal" style="display:none; position:fixed; top:10%; left:50%; transform:translateX(-50%);
	    background:white; padding:20px; border-radius:10px; box-shadow:0 2px 10px rgba(0,0,0,0.3); z-index:1000;">
	  <h3 style="margin-bottom:10px;">åƒèˆ‡åº—å®¶</h3>
	  <ul id="store-list" style="padding-left: 1rem; line-height: 1.6;"></ul>
	  <button class="btn btn-secondary" style="margin-top: 1rem;" onclick="closeModal()">é—œé–‰</button>
	</div>
</div>	

 <footer th:replace="~{front/common/footer :: main-footer}"></footer>
<script>
window.addEventListener('error', function (e) {
  alert("JavaScript ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹é–‹ç™¼è€…å·¥å…·æŸ¥çœ‹ console.logï¼");
});
</script>

<script>
const container = document.getElementById('acts-container');
fetch('/api/act/{actId}/stores').then(r => r.json()).then(data => console.log("æ´»å‹•è³‡æ–™ï¼š", data));
//è®€å–æ‰€æœ‰æ´»å‹•
fetch('/api/allActs')
	.then(res => res.json())
	.then(acts => {
		acts.forEach(act =>{ //è¿´åœˆ
			const item = document.createElement('div');
			item.className = 'act-item';
			
			item.innerHTML = `
				<div class="card">
					  <div class="card-left">
					  <img src="${act.actPhoto}" 
					       alt="${act.actName}" 
					       onerror="this.onerror=null; this.src='/images/act/default.png'"
					       style="width: 150px; height: 150px; object-fit: cover; border-radius: 6px; margin-bottom: 8px;">
					  </div>
					  <div class="card-right">
					  <div class="act-details">
					    <div class="act-name">${act.actName}</div>
					    <div class="act-content">${act.actContent.replace(/\n/g, '<br>')}</div>
					    <div class="act-dates">
					      æ´»å‹•é–‹å§‹æ™‚é–“: ${formatDateTime(act.actStartTime)}<br>
					      æ´»å‹•çµæŸæ™‚é–“: ${formatDateTime(act.actEndTime)}<br>
					    </div>
					    <a href="#" class="view-stores-link" data-actid="${act.actId}">ï¼œæŸ¥çœ‹åƒèˆ‡åº—å®¶ï¼</a>
					  </div>
					  </div>
			   </div>

				`;
			container.appendChild(item);
		})
	})

	//æŸ¥çœ‹åƒèˆ‡åº—å®¶
document.addEventListener('click', function (e) {
	  if (e.target.classList.contains('view-stores-link')) {
	    e.preventDefault();
	    const actId = e.target.dataset.actid;

	    fetch(`/api/act/${actId}/stores`)
	      .then(res => res.json())
	      .then(data => {
	        const list = document.getElementById('store-list');
	        list.innerHTML = '';
	        if (data.length === 0) {
	          list.innerHTML = '<li>ç›®å‰å°šç„¡åƒèˆ‡åº—å®¶</li>';
	          // é¡¯ç¤ºå½ˆçª—èˆ‡é®ç½©
              document.getElementById('store-modal').style.display = 'block';
        	  document.getElementById('modal-overlay').style.display = 'block';
	        } else {
	          data.forEach(store => {  //è¿´åœˆåŠ è³‡æ–™
	        	  console.log("ğŸ” store =", store); //consoleå¯çœ‹åˆ°storId
	            const li = document.createElement('li');
	         // å»ºç«‹åº—å®¶åç¨±
	            const storeLink = document.createElement('a')
	            storeLink.textContent = store.storName;
	            storeLink.href = `/category/store/${store.storId}`;  // âœ… è¨­å®šé€£çµ
	            storeLink.style.color = '#4A90E2';
	            storeLink.style.fontWeight = 'bold';  // æ¨¡æ“¬ strong æ¨£å¼
	            storeLink.style.textDecoration = 'none';  // å¯é¸ï¼šå»é™¤åº•ç·š
	            storeLink.target = '_blank';  // å¯é¸ï¼šåœ¨æ–°è¦–çª—æ‰“é–‹
	            li.appendChild(storeLink); // âœ… é€™è£¡æ”¹æˆ storeLink è€Œä¸æ˜¯ storeName
	        
	           

	            // å¦‚æœæœ‰å•†å“ï¼ŒåŠ å…¥å•†å“è¡¨æ ¼
	            if (store.products && store.products.length > 0) {
	              const table = document.createElement('table');
	              table.style.marginTop = '8px';
	              table.innerHTML = `
	                <thead>
	                  <tr><th>å•†å“åç¨±</th><th style=" text-align:right;">åŸåƒ¹</th><th style=" text-align:right;">æŠ˜æ‰£åƒ¹</th></tr>
	                </thead>
	                <tbody>
	                  ${store.products.map(prod => `
	                    <tr>
	                      <td>${prod.prodName}</td>
	                      <td style=" text-align:right;">${prod.prodPrice}</td>
	                      <td style="color:red; text-align:right;">${prod.discountedPrice}</td>
	                    </tr>
	                  `).join('')}
	                </tbody>
	                <hr>
	                <div style="margin-bottom: 1em;"></div>
	              `;
	              li.appendChild(table);
	            }
	              //åŠ å…¥åˆ°æ¸…å–®
	            list.appendChild(li);
	         // é¡¯ç¤ºå½ˆçª—èˆ‡é®ç½©
	        	  document.getElementById('store-modal').style.display = 'block';
	        	  document.getElementById('modal-overlay').style.display = 'block';
	          });
	        }
	        document.getElementById('store-modal').style.display = 'block';
	      })
	      .catch(err => {
	        alert("âš  è®€å–å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦");
	        console.error(err);
	      });
	  }
	});
	
//ä¿®æ­£æ™‚é–“æ ¼å¼
function formatDateTime(dateString) {
    const date = new Date(dateString);
    const yyyy = date.getFullYear();
    const mm = String(date.getMonth() + 1).padStart(2, '0');
    const dd = String(date.getDate()).padStart(2, '0');
    const hh = String(date.getHours()).padStart(2, '0');
    const mi = String(date.getMinutes()).padStart(2, '0');
    const ss = String(date.getSeconds()).padStart(2, '0');
    return `${yyyy}-${mm}-${dd} ${hh}:${mi}`;
}


//é»ç©ºç™½è™•é—œé–‰å½ˆçª—ï¼š
document.getElementById('modal-overlay').addEventListener('click', () => {
	  document.getElementById('store-modal').style.display = 'none';
	  document.getElementById('modal-overlay').style.display = 'none';
	});
	
	
function closeModal() {
	  document.getElementById('store-modal').style.display = 'none';
	  document.getElementById('modal-overlay').style.display = 'none';
	}
	
/*æ¸¬è©¦ç”¨å‡è³‡æ–™*/
// 	acts.forEach(act => {
// 		  const item = document.createElement('div');
// 		  item.className = 'act-item';
	
// 		  item.innerHTML = `
// 		    <img src="${act.ACT_PHOTO}" alt="${act.ACT_NAME}">
// 		    <div class="act-details">
// 		      <div class="act-name">${act.ACT_NAME}</div>
// 		      <div class="act-content">${act.ACT_CONTENT.replace(/\n/g, '<br>')}</div>
// 		      <div class="act-dates">
// 		        æ´»å‹•é–‹å§‹æ™‚é–“: ${act.ACT_STARTTIME}<br>
// 		        æ´»å‹•çµæŸæ™‚é–“: ${act.ACT_ENDTIME}<br>
// 		        <a href="#" class="view-stores-link" data-actid="${act.ACT_ID}">ï¼œæŸ¥çœ‹åƒèˆ‡åº—å®¶ï¼</a>
// 		      </div>
// 		    </div>
// 		    <div class="act-discount">${act.ACT_DISCOUNT_VALUE}</div>
// 		  `;
	
// 		  container.appendChild(item);
// 		});
	
	

	// const acts = [
//	 	  {
//	 	    ACT_ID: 1,
//	 	    ACT_NAME: "å¤æ—¥ç¥­å…¸",
//	 	    ACT_CONTENT: "é£²æ–™æŠ˜5å…ƒ",
//	 	    ACT_STARTTIME: "2025-08-01",
//	 	    ACT_ENDTIME: "2025-08-31",
//	 	    ACT_DISCOUNT_VALUE: "95 æŠ˜",
//	 	    ACT_PHOTO: "img/sample.jpg"
//	 	  },
//	 	  {
//	 	    ACT_ID: 2,
//	 	    ACT_NAME: "è‰è“å­£",
//	 	    ACT_CONTENT: "è‰è“æ–°å“ä¸Šå¸‚ï¼Œå…¨å“é … 9 æŠ˜",
//	 	    ACT_STARTTIME: "2025-08-05",
//	 	    ACT_ENDTIME: "2025-08-25",
//	 	    ACT_DISCOUNT_VALUE: "$100",
//	 	    ACT_PHOTO: "img/sample2.jpg"
//	 	  }
//	 	];
</script>

</body>
</html>