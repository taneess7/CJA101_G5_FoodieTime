<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>查看參與店家</title>
<!-- 引入icon圖片 -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
 <!-- header/footer cs -->
  <link rel="stylesheet" th:href="@{/css/common/index.css}">
  <link rel="stylesheet" th:href="@{/css/common/style.css}">
  
 <style>
    /* act.css */

.act-card {
  width: 320px;
  border: 1px solid #ddd;
  border-radius: 10px;
  overflow: hidden;
  background-color: #fff;
  box-shadow: 0 0 5px rgba(0,0,0,0.1);
}

.act-card img {
  width: 100%;
  height: 180px;
  object-fit: cover;
}

.act-body {
  padding: 1rem;
}

.act-title {
  font-size: 1.2rem;
  font-weight: bold;
  margin-bottom: 0.5rem;
}

.act-meta {
  font-size: 0.9rem;
  color: #666;
  margin-bottom: 0.25rem;
}

.act-desc {
  font-size: 0.95rem;
  margin-top: 0.75rem;
}

.acts-list {
  display: flex;         /* 啟用橫向排列 */
  flex-wrap: wrap;       /* 超出自動換行 */
  justify-content: flex-start; /* 卡片靠左對齊 */
 /* flex-direction: column;/*直排*/
  gap: 1.5rem;
  /*max-width: 800px; 會限制橫向排列最大寬度 搭配margin: 0 auto 卡片直排置中*/
  margin: 0 ;
  padding: 1rem;
  padding-top: 100px;
}

.act-item {
  display: flex;
  background: #fff;
  border-radius: 20px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  overflow: hidden;
  align-items: center;
  padding: 1rem;
  gap: 1rem;
  width: 400px;          /* ✅ 固定寬度 */
  flex-shrink: 0;        /* ✅ 避免縮小變形 */
}

/* 滑鼠移上去時的效果 */
.act-item:hover {
  transform: translateY(-5px); /* 上浮 5px */
  box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2); /* 加強陰影 */
  background-color: #fffaf0;  /* 淡灰背景，可改其他色 */
}

.act-item img {
  width: 100px;
  height: 100px;
  object-fit: cover;
  border-radius: 10px;
}

.act-details {
  flex: 1;
}

.act-name {
  font-weight: bold;
  font-size: 1.2rem;
  margin-bottom: 0.5rem;
  color:rgb(76, 175, 80);
}

.act-content {
  font-size: 0.95rem;
  line-height: 1.5;
}

.act-dates {
  font-size: 0.85rem;
  margin-top: 0.5rem;
  color: #666;
}

.act-discount {
  font-weight: bold;
  font-size: 1.1rem;
  white-space: nowrap;
}

.btn {
  display: inline-block;
  padding: 0.6rem 1.2rem;
  font-size: 1rem;
  font-weight: bold;
  color: white;
  background-color: #FF5722;
  border: none;
  border-radius: 8px;
  text-decoration: none;
  transition: background-color 0.3s ease;
}
.btn:hover {
  background-color: #e64a19;
}
.btn-secondary {
  background-color: #666;
}
.btn-secondary:hover {
  background-color: #444;
}

.acts-container {
  background-color: gray;
  display: flex;
  flex-wrap: wrap;      /* ✅ 多的自動換行 */
  flex-direction: row;  /* ✅ 水平排列（預設就是 row，可以加強明確性） */
  justify-content: flex-start; /* ✅ 左對齊 */
  gap: 1.5rem;          /* ✅ 卡片間距 */
}

 .app-header {
    position: fixed;           /* ✅ 固定在畫面頂部 */
    top: 0;
    left: 0;
    width: 100%;               /* 撐滿整個寬度 */
    z-index: 50;               /* 確保蓋在上方 */
    height: 64px;
    background-color: white;
    padding: 0 1rem;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    display: flex;
    align-items: center;
  }
  
  body {
  background-color: #fdf4f1;
}

  </style>


</head>
<body>
 <header th:replace="~{front/common/header :: main-header}"></header> 
 
<div id="acts-container" class="acts-list">

<!-- 活動卡片插入這裡 -->
<!-- Modal：查看參與店家，會跳出店家提示窗 -->
	<div id="store-modal" style="display:none; position:fixed; top:10%; left:50%; transform:translateX(-50%);
	    background:white; padding:20px; border-radius:10px; box-shadow:0 2px 10px rgba(0,0,0,0.3); z-index:1000;">
	  <h3 style="margin-bottom:10px;">參與店家</h3>
	  <ul id="store-list" style="padding-left: 1rem; line-height: 1.6;"></ul>
	  <button class="btn btn-secondary" style="margin-top: 1rem;" onclick="document.getElementById('store-modal').style.display='none'">關閉</button>
	</div>
</div>	

 <footer th:replace="~{front/common/footer :: main-footer}"></footer>
<script>
window.addEventListener('error', function (e) {
  alert("JavaScript 發生錯誤，請開發者工具查看 console.log！");
});
</script>

<script>
const container = document.getElementById('acts-container');
fetch('/api/act/{actId}/stores').then(r => r.json()).then(data => console.log("活動資料：", data));
//讀取所有活動
fetch('/api/allActs')
	.then(res => res.json())
	.then(acts => {
		acts.forEach(act =>{ //迴圈
			const item = document.createElement('div');
			item.className = 'act-item';
			
			item.innerHTML = `
				  <img src="${act.actPhoto}" 
				       alt="${act.actName}" 
				       onerror="this.onerror=null; this.src='/images/act/default.png'"
				       style="width: 150px; height: 150px; object-fit: cover; border-radius: 6px; margin-bottom: 8px;">
				  
				  <div class="act-details">
				    <div class="act-name">${act.actName}</div>
				    <div class="act-content">${act.actContent.replace(/\n/g, '<br>')}</div>
				    <div class="act-dates">
				      活動開始時間: ${formatDateTime(act.actStartTime)}<br>
				      活動結束時間: ${formatDateTime(act.actEndTime)}<br>
				    </div>
				    <a href="#" class="view-stores-link" data-actid="${act.actId}">＜查看參與店家＞</a>
				  </div>

				`;
			container.appendChild(item);
		})
	})

	//查看參與店家
document.addEventListener('click', function (e) {
	  if (e.target.classList.contains('view-stores-link')) {
	    e.preventDefault();
	    const actId = e.target.dataset.actid;

	    fetch(`/api/act/${actId}/stores`)
	      .then(res => res.json())
	      .then(data => {
	        const list = document.getElementById('store-list');
	        list.innerHTML = '';
	        if (data.length === 0) {
	          list.innerHTML = '<li>目前尚無參與店家</li>';
	        } else {
	          data.forEach(store => {  //迴圈
	            const li = document.createElement('li');
	            li.textContent = store.storName; // 根據你的 StoreVO 設定
	            list.appendChild(li);
	          });
	        }
	        document.getElementById('store-modal').style.display = 'block';
	      })
	      .catch(err => {
	        alert("⚠ 讀取失敗，請稍後再試");
	        console.error(err);
	      });
	  }
	});
	
//修正時間格式
function formatDateTime(dateString) {
    const date = new Date(dateString);
    const yyyy = date.getFullYear();
    const mm = String(date.getMonth() + 1).padStart(2, '0');
    const dd = String(date.getDate()).padStart(2, '0');
    const hh = String(date.getHours()).padStart(2, '0');
    const mi = String(date.getMinutes()).padStart(2, '0');
    const ss = String(date.getSeconds()).padStart(2, '0');
    return `${yyyy}-${mm}-${dd} ${hh}:${mi}`;
}
	
/*測試用假資料*/
// 	acts.forEach(act => {
// 		  const item = document.createElement('div');
// 		  item.className = 'act-item';
	
// 		  item.innerHTML = `
// 		    <img src="${act.ACT_PHOTO}" alt="${act.ACT_NAME}">
// 		    <div class="act-details">
// 		      <div class="act-name">${act.ACT_NAME}</div>
// 		      <div class="act-content">${act.ACT_CONTENT.replace(/\n/g, '<br>')}</div>
// 		      <div class="act-dates">
// 		        活動開始時間: ${act.ACT_STARTTIME}<br>
// 		        活動結束時間: ${act.ACT_ENDTIME}<br>
// 		        <a href="#" class="view-stores-link" data-actid="${act.ACT_ID}">＜查看參與店家＞</a>
// 		      </div>
// 		    </div>
// 		    <div class="act-discount">${act.ACT_DISCOUNT_VALUE}</div>
// 		  `;
	
// 		  container.appendChild(item);
// 		});
	
	

	// const acts = [
//	 	  {
//	 	    ACT_ID: 1,
//	 	    ACT_NAME: "夏日祭典",
//	 	    ACT_CONTENT: "飲料折5元",
//	 	    ACT_STARTTIME: "2025-08-01",
//	 	    ACT_ENDTIME: "2025-08-31",
//	 	    ACT_DISCOUNT_VALUE: "95 折",
//	 	    ACT_PHOTO: "img/sample.jpg"
//	 	  },
//	 	  {
//	 	    ACT_ID: 2,
//	 	    ACT_NAME: "草莓季",
//	 	    ACT_CONTENT: "草莓新品上市，全品項 9 折",
//	 	    ACT_STARTTIME: "2025-08-05",
//	 	    ACT_ENDTIME: "2025-08-25",
//	 	    ACT_DISCOUNT_VALUE: "$100",
//	 	    ACT_PHOTO: "img/sample2.jpg"
//	 	  }
//	 	];
</script>

</body>
</html>